@{
    ViewBag.Header = "Menu";
    ViewBag.Title = "Menu Management";
    ViewBag.Description = "Menu Management Page";
}
@section styles{
    <link rel="stylesheet" href="/Content/backend/css/jquery-ui-1.10.3.full.min.css" />
    <link rel="stylesheet" href="/Content/backend/css/datepicker.css" />
    <link rel="stylesheet" href="/Content/backend/css/ui.jqgrid.css" />
}
<div class="page-header">
    <h1>@ViewBag.Header
        <small>
            <i class="icon-double-angle-right"></i>
            @ViewBag.Title
        </small>
    </h1>
</div>
<div class="row">
    <div class="col-xs-12">
        <!-- PAGE CONTENT BEGINS -->

        <table id="grid-table"></table>

        <div id="grid-pager"></div>

        <!-- PAGE CONTENT ENDS -->
    </div>
</div>
@section scripts
{
    <script src="/Scripts/BackEnd/date-time/bootstrap-datepicker.min.js"></script>
    <script src="/Scripts/BackEnd/jqGrid/jquery.jqGrid.min.js"></script>
    <script src="/Scripts/BackEnd/jqGrid/i18n/grid.locale-en.js"></script>
    <script type="text/javascript">
        var gridSelector = "#grid-table";
        var pagerSelector = "#grid-pager";
        //init some data before create box show
        function initCreateData() {
            $(gridSelector).setColProp('ParentName', { editoptions: { dataUrl: '@Url.Action("GetParents")' } });
        }

        var icons = {
            "icon-adjust": "icon-adjust",
            "icon-asterisk": "icon-asterisk",
            "icon-ban-circle": "icon-ban-circle",
            "icon-bar-chart": "icon-bar-chart",
            "icon-barcode": "icon-barcode",
            "icon-beaker": "icon-beaker",
            "icon-beer": "icon-beer",
            "icon-bell": "icon-bell",
            "icon-bell-alt": "icon-bell-alt",
            "icon-bolt": "icon-bolt",
            "icon-book": "icon-book",
            "icon-bookmark": "icon-bookmark",
            "icon-bookmark-empty": "icon-bookmark-empty",
            "icon-briefcase": "icon-briefcase",
            "icon-bullhorn": "icon-bullhorn",
            "icon-calendar": "icon-calendar",
            "icon-camera": "icon-camera",
            "icon-camera-retro": "icon-camera",
            "icon-certificate": "icon-certificate",
            "icon-check": "icon-check",
            "icon-check-empty": "icon-check-empty",
            "icon-circle": "icon-circle",
            "icon-circle-blank": "icon-circle-blank",
            "icon-cloud": "icon-cloud",
            "icon-cloud-download": "icon-cloud-download",
            "icon-cloud-upload": "icon-cloud-upload",
            "icon-coffee": "icon-coffee",
            "icon-cog": "icon-cog",
            "icon-cogs": "icon-cogs",
            "icon-comment": "icon-comment",
            "icon-comment-alt": "icon-comment-alt",
            "icon-comments": "icon-comments",
            "icon-comments-alt": "icon-comments-alt",
            "icon-credit-card": "icon-credit-card",
            "icon-dashboard": "icon-dashboard",
            "icon-desktop": "icon-desktop",
            "icon-download": "icon-download",
            "icon-download-alt": "icon-download-alt",
            "icon-edit": "icon-edit",
            "icon-envelope": "icon-envelope",
            "icon-envelope-alt": "icon-envelope-alt",
            "icon-exchange": "icon-exchange",
            "icon-exclamation-sign": "icon-exclamation-sign",
            "icon-external-link": "icon-external-link",
            "icon-eye-close": "icon-eye-close",
            "icon-eye-open": "icon-eye-open",
            "icon-facetime-video": "icon-facetime-video",
            "icon-fighter-jet": "icon-fighter-jet",
            "icon-film": "icon-film",
            "icon-filter": "icon-filter",
            "icon-fire": "icon-fire",
            "icon-flag": "icon-flag",
            "icon-folder-close": "icon-folder-close",
            "icon-folder-open": "icon-folder-open",
            "icon-folder-close-alt": "icon-folder-close-alt",
            "icon-folder-open-alt": "icon-folder-open-alt",
            "icon-food": "icon-food",
            "icon-gift": "icon-gift",
            "icon-glass": "icon-glass",
            "icon-globe": "icon-globe",
            "icon-group": "icon-group",
            "icon-hdd": "icon-hdd",
            "icon-headphones": "icon-headphones",
            "icon-heart": "icon-heart",
            "icon-heart-empty": "icon-heart-empty",
            "icon-home": "icon-home",
            "icon-inbox": "icon-inbox",
            "icon-info-sign": "icon-info-sign",
            "icon-key": "icon-key",
            "icon-leaf": "icon-leaf",
            "icon-laptop": "icon-laptop",
            "icon-legal": "icon-legal",
            "icon-lemon": "icon-lemon",
            "icon-lightbulb": "icon-lightbulb",
            "icon-lock": "icon-lock",
            "icon-unlock": "icon-unlock"
        };
        jQuery(function ($) {
            jQuery(gridSelector).jqGrid({
                datatype: "json",
                url: "@Url.Action("_AjaxBinding")",
                caption: "Menu Management",
                height: 370,
                colNames: ['Id', 'Name', 'Url', 'Controller', 'Action', 'Parent Menu', 'MenuClass', "Visible", 'Order', 'Active', 'Created', 'CreatedBy', 'Updated', 'UpdatedBy'],
                colModel: [
                    { name: 'Id', index: 'Id', width: 60, key: true, sorttype: "int" },
                    { name: 'Name', index: 'Name', width: 150, editable: true, editrules: { required: true } },
                    { name: 'Url', index: 'Url', width: 50, editable: true },
                    { name: 'Controller', index: 'Controller', width: 120, editable: true },
                    { name: 'Action', index: 'Action', width: 120, editable: true },
                    {
                        name: 'ParentName', index: 'ParentName', width: 180, editable: true, edittype: "select",
                        editoptions: {
                            dataUrl: '@Url.Action("GetParents")',
                            buildSelect: function (response) {
                                return buildDropdown(response);
                            }
                        }
                    },
                    {
                        name: 'MenuIcon', index: 'MenuIcon', width: 150, editable: true, edittype: "select",
                        editoptions: {
                            value: icons
                        }
                    },
                    { name: 'VisibleString', index: 'VisibleString', width: 100, editable: true, edittype: "checkbox", align: "center", editoptions: { value: "Yes:No", defaultValue: 'Yes' }, unformat: aceSwitch },
                    { name: 'RecordOrder', index: 'RecordOrder', width: 50, sorttype: "int", align: "center", editable: true, editrules: { required: true } },
                    { name: 'Active', index: 'Active', width: 100, editable: true, edittype: "checkbox",  align:"center", editoptions: { value: "Yes:No", defaultValue: 'Yes' }, unformat: aceSwitch },
                    { name: 'Created', index: 'Created', formatter: "date", width: 100, editable: false, sorttype: "datetime", unformat: pickDate },
                    { name: 'CreatedBy', index: 'CreatedBy', width: 150, editable: false, editoptions: { size: "20", maxlength: "30" } },
                    { name: 'Updated', index: 'Updated', formatter: "date", width: 90, editable: false, sorttype: "datetime", unformat: pickDate },
                    { name: 'UpdatedBy', index: 'UpdatedBy', width: 150, editable: false, editoptions: { size: "20", maxlength: "30" } }
                ],
                pager: pagerSelector,
                rowNum: 10,
                rowList: [10, 20, 30],
                shrinkToFit: false,
                editurl: '@Url.Action("Manage")',

                //Before select row change data Url base on page id
                beforeSelectRow: function (rowId) {
                    var tmpId = $(gridSelector).getRowData(rowId)['Id'];
                    $(gridSelector).setColProp('ParentName', { editoptions: { dataUrl: '@Url.Action("GetParents")/' + tmpId } });
                    return true;
                },
                //Default Value
                altRows: true,
                multiboxonly: true,
                autowidth: true,
                viewrecords: true,
                loadComplete: function () {
                    var table = this;
                    setTimeout(function () {
                        styleCheckbox(table);
                        updateActionIcons(table);
                        updatePagerIcons(table);
                        enableTooltips(table);
                    }, 0);
                }
            });

            //enable search/filter toolbar
            jQuery(gridSelector).jqGrid('filterToolbar', { defaultSearch: "cn", stringResult: true });
        });
    </script>
    <script src="/Scripts/Shared/grid.js"></script>

}
