@{
    Layout = "../Shared/_Layout.cshtml";
    ViewBag.Header = "Command Histories";
    ViewBag.Title = "Command History Management";
    ViewBag.Description = "Command History Management Page";
}
@section styles{
    <link rel="stylesheet" href="/Content/backend/css/datepicker.css" />
    <link rel="stylesheet" href="/Content/backend/css/ui.jqgrid.css" />
}
<div class="page-header">
    <h1>@ViewBag.Header
    </h1>
</div>
<div style="display: table">
    <div class="col-xs-11">
        <!-- PAGE CONTENT BEGINS -->

        <table id="grid-table"></table>

        <div id="grid-pager"></div>

        <!-- PAGE CONTENT ENDS -->
    </div>
</div>
@section scripts
{
    <script src="/Scripts/BackEnd/date-time/bootstrap-datepicker.min.js"></script>
    <script src="/Scripts/BackEnd/jqGrid/jquery.jqGrid.min.js"></script>
    <script src="/Scripts/BackEnd/jqGrid/i18n/grid.locale-en.js"></script>
    <script type="text/javascript">
        var gridSelector = "#grid-table";
        var pagerSelector = "#grid-pager";
        var navButtonsSetup = {
            enableEdit: true,
            enableCreate: true,
            enableDelete: true,
            enableSearch: true,
            enableRefresh: true,
            enableView: true
        };
        function selectVersion(query) {
            window.parent.ValueSelected(query);
            parent.$.fancybox.close();
        }
        jQuery(function ($) {
            jQuery(gridSelector).jqGrid({
                datatype: "json",
                url: "@Url.Action("_AjaxHistory")",
                caption: "Command History Management",
                height: 340,
                ondblClickRow: function (rowId) {
                    jQuery(gridSelector).editRow(rowId, true);
                },
                colNames: ['', 'Id', 'Query', 'Updated', 'UpdatedBy'],
                colModel: [
                    {
                        name: 'actions', width: 60, sortable: false, search: false, align: "center",
                        formatter: function (cellvalue, options, rowObject) {
                            var query = rowObject["Query"];
                            var selectIcon = "<a class='select-query' href='javascript:selectVersion(\"" + query + "\")'><div class='ui-pg-div ui-inline-edit' title='' data-original-title='Select this'><span class='icon-check'></span></div></a>";
                            return selectIcon;
                        }
                    },
                    { name: 'Id', index: 'Id', width: 50, key: true, sorttype: "int", align: "center" },
                    { name: 'Query', index: 'Query', width: 850, editable: true, editrules: { required: true } },
                    { name: 'Updated', index: 'Updated', formatter: "date", width: 80, editable: false, sorttype: "datetime", unformat: pickDate },
                    { name: 'UpdatedBy', index: 'UpdatedBy', width: 180, editable: false, editoptions: { size: "20", maxlength: "30" } }
                ],
                pager: pagerSelector,
                rowList: [10, 20, 30],
                shrinkToFit: true,
                editurl: '@Url.Action("Manage")',

                //Default Value
                altRows: true,
                multiboxonly: true,
                autowidth: false,
                viewrecords: true,
                loadComplete: function () {
                    var table = this;
                    setTimeout(function () {
                        styleCheckbox(table);
                        updateActionIcons(table);
                        updatePagerIcons(table);
                        enableTooltips(table);
                    }, 0);
                }
            });

            //enable search/filter toolbar
            jQuery(gridSelector).jqGrid('filterToolbar', { defaultSearch: "cn", stringResult: true });
        });
    </script>
    <script src="/Scripts/Shared/grid.js"></script>
}
